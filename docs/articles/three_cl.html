<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ISLR's CNN for classifying a subset of CIFAR100 images • littleDeep</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ISLR's CNN for classifying a subset of CIFAR100 images">
<meta property="og:description" content="littleDeep">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">littleDeep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/littleDeep.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/deep.html">Deep Learning excursion 0: Based on ISLR online book</a>
    </li>
    <li>
      <a href="../articles/geom_shapes.html">ISLR's CNN for classifying geometric shapes</a>
    </li>
    <li>
      <a href="../articles/three_cl.html">ISLR's CNN for classifying a subset of CIFAR100 images</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vjcitn/littleDeep/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ISLR’s CNN for classifying a subset of CIFAR100 images</h1>
                        <h4 data-toc-skip class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 data-toc-skip class="date">June 27, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vjcitn/littleDeep/blob/HEAD/vignettes/three_cl.Rmd"><code>vignettes/three_cl.Rmd</code></a></small>
      <div class="hidden name"><code>three_cl.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The CIFAR100 data includes some challenging image categories, and the demonstration convolutional neural network (CNN) examined in the ISLR book has relatively low accuracy over the entire set of images. In this vignette we will use the ImageArray class operations to form a subset of images of boys, roses, and chairs, train with these images, and assess accuracy.</p>
</div>
<div class="section level2">
<h2 id="build-imagearray-instances">Build ImageArray instances<a class="anchor" aria-label="anchor" href="#build-imagearray-instances"></a>
</h2>
<p>We need two packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vjcitn/littleDeep">littleDeep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://arxiv.org/abs/1403.2805" class="external-link">jsonlite</a></span><span class="op">)</span></span></code></pre></div>
<p>We’ll start by getting the fine-grained image types from CIFAR100 JSON.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cifmeta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"cif.json"</span>, package<span class="op">=</span><span class="st">"littleDeep"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">labs</span> <span class="op">=</span> <span class="va">cifmeta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">features</span><span class="op">$</span><span class="va">fine_label</span><span class="op">$</span><span class="va">names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">labs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "apple"         "aquarium_fish" "baby"          "bear"         </span></span>
<span><span class="co">## [5] "beaver"        "bed"</span></span></code></pre>
<p>Now get the image data and work with the training set to produce an ImageArray.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"cifdata"</span><span class="op">)</span><span class="op">)</span> <span class="va">cifdata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/dataset_cifar100.html" class="external-link">dataset_cifar100</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ciftrain</span> <span class="op">=</span> <span class="va">cifdata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">ciflabels</span> <span class="op">=</span> <span class="va">labs</span><span class="op">[</span><span class="va">cifdata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">=</span> <span class="fu"><a href="../reference/ImageArray.html">ImageArray</a></span><span class="op">(</span><span class="va">ciftrain</span>, <span class="va">ciflabels</span><span class="op">)</span></span>
<span><span class="va">train</span></span></code></pre></div>
<pre><code><span><span class="co">## ImageArray instance with 50000 images, each 32 x 32 x 3</span></span>
<span><span class="co">##  Image types: cattle dinosaur ... pickup_truck can </span></span>
<span><span class="co">##  Array elements range from 0.000000 to 255.000000.</span></span></code></pre>
<p>Same for the test images:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciftest</span> <span class="op">=</span> <span class="va">cifdata</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">ciftestlabs</span> <span class="op">=</span> <span class="va">labs</span><span class="op">[</span><span class="va">cifdata</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="fu"><a href="../reference/ImageArray.html">ImageArray</a></span><span class="op">(</span><span class="va">ciftest</span>, <span class="va">ciftestlabs</span><span class="op">)</span></span>
<span><span class="va">test</span></span></code></pre></div>
<pre><code><span><span class="co">## ImageArray instance with 10000 images, each 32 x 32 x 3</span></span>
<span><span class="co">##  Image types: mountain forest ... bear tiger </span></span>
<span><span class="co">##  Array elements range from 0.000000 to 255.000000.</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="filter-the-imagearrays-to-specific-image-classes">Filter the ImageArrays to specific image classes<a class="anchor" aria-label="anchor" href="#filter-the-imagearrays-to-specific-image-classes"></a>
</h2>
<p>We make a vector of image types of interest and use <code>filterByType</code> to subset the ImageArrays.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">littrain</span> <span class="op">=</span> <span class="fu"><a href="../reference/filterByType.html">filterByType</a></span><span class="op">(</span><span class="va">train</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"boy"</span>, <span class="st">"rose"</span>, <span class="st">"chair"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">littest</span> <span class="op">=</span> <span class="fu"><a href="../reference/filterByType.html">filterByType</a></span><span class="op">(</span><span class="va">test</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"boy"</span>, <span class="st">"rose"</span>, <span class="st">"chair"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">littrain</span></span></code></pre></div>
<pre><code><span><span class="co">## ImageArray instance with 1500 images, each 32 x 32 x 3</span></span>
<span><span class="co">##  Image types: boy rose chair </span></span>
<span><span class="co">##  Array elements range from 0.000000 to 255.000000.</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">littrain</span><span class="op">)</span></span></code></pre></div>
<p><img src="three_cl_files/figure-html/dofilt-1.png" width="700"></p>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="fit-and-assess">Fit and assess<a class="anchor" aria-label="anchor" href="#fit-and-assess"></a>
</h2>
<p>This can take a few minutes on a CPU. We use the default number of epochs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">=</span> <span class="fu"><a href="../reference/islr_cnn.html">islr_cnn</a></span><span class="op">(</span> <span class="va">littrain</span> <span class="op">)</span></span>
<span><span class="va">rr</span><span class="op">$</span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## Model: "sequential"</span></span>
<span><span class="co">## ________________________________________________________________________________</span></span>
<span><span class="co">##  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">## ================================================================================</span></span>
<span><span class="co">##  conv2d_3 (Conv2D)                  (None, 32, 32, 32)              896         </span></span>
<span><span class="co">##  max_pooling2d_3 (MaxPooling2D)     (None, 16, 16, 32)              0           </span></span>
<span><span class="co">##  conv2d_2 (Conv2D)                  (None, 16, 16, 64)              18496       </span></span>
<span><span class="co">##  max_pooling2d_2 (MaxPooling2D)     (None, 8, 8, 64)                0           </span></span>
<span><span class="co">##  conv2d_1 (Conv2D)                  (None, 8, 8, 128)               73856       </span></span>
<span><span class="co">##  max_pooling2d_1 (MaxPooling2D)     (None, 4, 4, 128)               0           </span></span>
<span><span class="co">##  conv2d (Conv2D)                    (None, 4, 4, 256)               295168      </span></span>
<span><span class="co">##  max_pooling2d (MaxPooling2D)       (None, 2, 2, 256)               0           </span></span>
<span><span class="co">##  flatten (Flatten)                  (None, 1024)                    0           </span></span>
<span><span class="co">##  dropout (Dropout)                  (None, 1024)                    0           </span></span>
<span><span class="co">##  dense_1 (Dense)                    (None, 512)                     524800      </span></span>
<span><span class="co">##  dense (Dense)                      (None, 3)                       1539        </span></span>
<span><span class="co">## ================================================================================</span></span>
<span><span class="co">## Total params: 914,755</span></span>
<span><span class="co">## Trainable params: 914,755</span></span>
<span><span class="co">## Non-trainable params: 0</span></span>
<span><span class="co">## ________________________________________________________________________________</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rr</span><span class="op">$</span><span class="va">history</span><span class="op">)</span></span></code></pre></div>
<p><img src="three_cl_files/figure-html/dofit-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eval_model.html">eval_model</a></span><span class="op">(</span><span class="va">rr</span><span class="op">$</span><span class="va">model</span>, <span class="va">littest</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.87</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Vincent Carey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
